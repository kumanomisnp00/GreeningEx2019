# プレイヤーについて

# プレイヤーの動き([前回のドキュメント](https://docs.google.com/document/d/1M3HuHCMwcyX0YxrCZ7hcdabwtVTFSJ9eM1Oxgyk7jSw/)より)

## 操作
- 左右キー or ADキー
  - 左右移動
- 上下キー or WSキー
  - ツタの昇り降り
- Z or Shiftキー
  - 水やりキー
- X or Spaceキー
  - 行動キー。条件によって動きが変わる

なお、確認などの操作は、水やりと行動の双方を有効にして、決定キーとする。

## 行動
- 空からハスを落下傘がわりにして降りてくる
- 棒立ち
- 左右移動
- 水やり
- 水に落ちてミス
- 苗を持ち上げる
- 苗を運ぶ
- 苗を置く
- ツタにつかまる
- ツタの昇り降り
- 綿毛につかまる
- キノコジャンプ
- 落下
- 玉乗り(押すのと乗る2つの動作が混ざっている。要検討)
- 花ジャンプ
- クリアの星に触れてから、次のステージに飛び立つアニメ

# 状態遷移(じょうたいせんい)
各状態から、他の状態に遷移する条件を整理する。

※実装のための仮決めであり、最終決定ではない。実際に操作してみて、もっとよい方法が見つかったり、比較したい操作方法があれば、複数のパターンを作って比較する。

## ゲーム開始
- 空からハスを落下傘がわりにして降りてくる
- 着地した
  - 棒立ちへ
  - 「スタート」の表示

## 棒立ち
- 足場がない
  - 落下へ
- 左右キーが押された
  - 左右移動へ
- 上下キーが押された
  - ツタがあったら、ツタを登るへ
- 水キーが押された
  - 水やりへ
- アクションキーが押された
  - 苗があったら
    - 苗を持ち上げるへ
  - 綿毛があったら
    - 綿毛につかまるへ
  - キノコがあったら
    - キノコのジャンプ範囲(2～3マス程度)から、ジャンプ開始可能になる
    - キノコに飛び乗って、ジャンプ
    - どのぐらい離れていたかによって、横の速度が変わる
    - ジャンプへ
  - 玉があったら(要検討)
    - 玉乗りへ
  - 花があったら(要検討)
    - 花ジャンプへ

## 左右移動
- 左右キー離したら止まる
- 足場がなくなったら落下する
- オブジェクトに当たったら止まる

## 水やり
- 水やり中動けない(振り向き可)
- 水キーを離した
  - 棒立ちへ

## 水に落ちてミス
- アニメが終わったらスタート地点に戻る

## 苗を持ち上げる
- アクションキーを離したら苗を置く

## 苗を運ぶ
- アクションキーを離したら苗を置く
- (左右キーを押したら、左右移動)

## 苗を置く
- アニメが終わったら棒立ちへ

## ツタにつかまる
- 上下キーで昇り降り
- ツタの一番上まで登ったら立つ
- ツタの一番下まで降りたら棒立ち
- 左右キーで飛び降り

## 綿毛につかまる
- アクションキーを離したら落下
- 綿毛が消えたら、落下へ

## キノコジャンプ
- 速度が上なだけで、処理は落下と同じ

## 落下
- 足場(地面、玉、花の橋)があったら棒立ちへ
- ツタがあったらつかまる

## 玉乗り
- アクションキーで降りる
- (左右キーで移動)
- (落下したら、同じ場所に乗ったまま落下)

## 花ジャンプ
- キノコジャンプと同様

## クリアの星に触れてから、次のステージに飛び立つアニメ
- アニメが終わったらクリアへ

---

## その他要望や注意事項
### 苗の挙動
- 水に落とした場合初期位置に苗がリスポーン

### 綿毛
- 壁にぶつかったら、ぶつかった方向への移動を止める。ぶつかってない方向には移動を続ける

### プレイヤーモーション要望
- 玉に乗っていないとき押すモーションがほしい


# 状態名を決める
行動の状態を何で判断するかを検討する。

- ゲーム開始から着地するまで
- 移動
  - 棒立ち
  - 左右移動
    - 棒立ち状態で、左右キーが押されているか
  - 落下
  - 花ジャンプ
- 水やり
- 水に落ちてミス
- 苗を持ち上げる
- 苗を運ぶ
  - 棒立ちと歩きに付随
  - アクションキー押しっぱなし
- 苗を置く
- ツタにつかまる
- 綿毛につかまる
- キノコ飛び乗りジャンプ
- 玉乗り
- クリア

enum型で、上記の動作状態を決める。

```cs
public enum ActionType {
    None = -1,
    Start,
    Move,
    Water,
    Obore,
    Pickup,
    NaeMove,
    Putdown,
    Tsuta,
    Watage,
    Kinoko,
    Tamanori,
    Clear
}
```


# AnimatorのParameterを決める
- 同時になってはいけない状態(=排他的という)は、enumで定義して、AnimatorにはIntegerで渡す
  - 棒立ちや左右移動など
- 他の動作に追加して動かしたい場合は、Bool型
  - 苗を運ぶなど
- プレイヤーの行動は変わらないが、アニメの切り替えが発生する要素は、適切な型で設定
  - 上昇中と落下中を切り替えるためのY速度なら、Float型

## アニメの状態(IntegerのStateで制御したいもの)
```cs
public enum AnimType {
  Start,
  Walk, 
  Jump,
  Water,
  Obore,
  Pickup,
  Tsuta,
  Watage,
  Clear,
}

```

- Bool型のNaeパラメーターで表す
  - 苗を持つアニメに切り替わるようにする
- Float型の速度VelXを渡して、立っているのと歩きを切り替える
  - アニメ再生速度は、スクリプトで指定
- Float型の速度VelYを渡して、上昇中と、下降中のパターンを切り替える
  - ジャンプと落下はJumpに統合
- Putdownは、Pickupの逆再生になる
  - プログラム側で、AnimatorのSpeedを-1にして逆再生にする
- Tsutaのアニメの速度は、プログラムで調整する
- キノコジャンプと玉乗りジャンプと、花ジャンプは、同じJumpで行う



